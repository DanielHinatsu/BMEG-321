%Plot Generating Code
% Description: this code was created to process the text data field generated by a circuit simulating EMG in the program LTSplice


%% Load Data
% Simple circuit transient
simpletransient = readtable("simple circuit transient.txt");
simpletimetransient = simpletransient.time;
simplevaluetransient = simpletransient.V_n002_;
% Simple circuit AC
simpleAC = readtable("simple circuit ac.txt");
simplefreqAC = simpleAC.Freq_;
simplevalueAC = simpleAC.V_n002_;
% Lowpass saturation
saturated = readtable("saturation.txt");
sattime = saturated.time;
satvalue = saturated.V_n002_;
% Final circuit transient
finaltransient = readtable("final circuit transient.txt");
time = finaltransient.time;
VoltageOutput1 = finaltransient.V_n008_;
VoltageOutput2 = finaltransient.V_n011_;
VoltageOutput3 = finaltransient.V_n002_;
VoltageOutput4 = finaltransient.V_n014_;
VoltageOutput5 = finaltransient.V_n015_;
% Final circuit AC
finalAC = readtable("finalAC.txt");
Freq = finalAC.Freq_;
OutputStringVector1 = finalAC.V_n008_;
OutputStringVector2 = finalAC.V_n011_;
OutputStringVector3 = finalAC.V_n002_;
%% Simple Transient Plot
plot(simpletimetransient, simplevaluetransient, 'LineWidth',1);
xlabel("Time (s)"); xlim([min(simpletimetransient) max(simpletimetransient)]);
ylabel("Amplitude (V)");
title("Simple Circuit Transient Analysis");
%% Simple AC Plot
[SMagResponse,SPhaseResponse] = convertStringVector(simplevalueAC);
figure;
semilogx(simplefreqAC, SMagResponse,'LineWidth',1);
xlabel("Frequency (Hz)"); xlim([min(simplefreqAC) max(simplefreqAC)]);
ylabel("Magnitude Response (dB)");
title("Simple Circuit AC Analysis");
%% Saturation Plot
plot(sattime, satvalue, 'LineWidth',1);
xlabel("Time (s)"); xlim([min(sattime) max(sattime)]);
ylabel("Amplitude (V)");
title("Lowpass Filter Saturation Output (Transient)");
%% Time Domain Plot
figure;
plot(time,VoltageOutput1,'LineWidth',1); hold on;
plot(time,VoltageOutput2,'--','LineWidth',1);
plot(time,VoltageOutput3,'LineWidth',1);
plot(time,VoltageOutput4,'LineWidth',1);
plot(time,VoltageOutput5,'LineWidth',1);
legend("Amplifier Output","Highpass Output","Lowpass Output",...
      "Summing Output","Rectifier Output","Location","southoutside",...
      "numcolumns",5);
xlabel("Time (s)"); xlim([min(time) max(time)]);
yticks(-5:1:5);
ylabel("Amplitude (V)");
title("Transient Response of Final Circuit");
%% Time Domain Plot Zoomed
figure;
plot(time,VoltageOutput1,'LineWidth',1); hold on;
plot(time,VoltageOutput2,'--','LineWidth',1);
legend("Amplifier Output","Highpass Output", "Location","southoutside",...
      "numcolumns",5);
xlabel("Time (s)"); xlim([min(time) max(time)]);
ylabel("Amplitude (V)");
title("Zoomed Transient Response of Amplifier and Highpass Output");
%% Frequency Plot
[MagResponse1,PhaseResponse1] = convertStringVector(OutputStringVector1);
[MagResponse2,PhaseResponse2] = convertStringVector(OutputStringVector2);
[MagResponse3,PhaseResponse3] = convertStringVector(OutputStringVector3);
figure;
semilogx(Freq,MagResponse1,'LineWidth',1); hold on;
semilogx(Freq,MagResponse2,'LineWidth',1);
semilogx(Freq,MagResponse3,'LineWidth',1);
legend("Amplifier Output","Highpass Output","Lowpass Output",...
      "Location","southoutside","numcolumns",3);
xlabel("Frequency (Hz)"); xlim([min(Freq) max(Freq)]);
ylabel("Magnitude Response (dB)");
title("AC Analysis Response of Final Circuit ");
%%
function [Mag,Phase] = convertStringVector(strVect)
   strSplit = split(strVect,",");
   strStrip = erase(strSplit,["(",")","dB","Â°"]);
   strNum = str2double(strStrip);
   Mag = strNum(:,1);
   Phase = strNum(:,2);
end
